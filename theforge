--[[
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    MOB FARM v4.3 - FAST HOVER + NOCLIP + AUTO WORLD 2 TELEPORT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    FEATURES:
    â€¢ Much faster hovering with increased speed limits
    â€¢ NOCLIP enabled - pass through walls and terrain
    â€¢ Physics-based movement (BodyVelocity + BodyGyro)
    â€¢ AUTO-TELEPORT to World 2 on startup (World 1 only)
    â€¢ Automatic portal placement and interaction
    â€¢ Safe for anti-cheat systems
    
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local GuiService = game:GetService("GuiService")

local LocalPlayer = Players.LocalPlayer
local Living = workspace:WaitForChild("Living")

-- World Detection
local WORLD1_JOBID = "61c99586-ab42-47aa-9380-ad1384a01528"
local WORLD2_JOBID = "3ae23189-431b-40a7-afbb-bbae83587e4c"
local PORTAL_PLACEMENT_POSITION = Vector3.new(-254.76, 17.65, 102.65)

local function getCurrentWorld()
    local currentJobId = game.JobId
    if currentJobId == WORLD1_JOBID then
        return 1
    elseif currentJobId == WORLD2_JOBID then
        return 2
    else
        return 1
    end
end

local currentWorld = getCurrentWorld()

-- Global Config
_G.MobFarmConfig = {
    -- Settings
    enabled = false,
    behindDistance = 12,
    verticalDistance = 15,
    farmDistance = 500,
    hoverSpeed = 80,
    acceleration = 40,
    lockPosition = "Back",
    unlockInterval = 0.3,
    lastUnlockTime = 0,
    
    -- State
    currentMob = nil,
    bodyVelocity = nil,
    bodyGyro = nil,
    noclipLoop = nil,
    
    -- Auto-rejoin
    autoRejoinEnabled = true,
    autoTeleportOnStart = true,
    
    -- Mob types
    mobTypes = {
        {name = "Slime", pattern = "Slime", enabled = true},
        {name = "Blazing Slime", pattern = "BlazingSlime", enabled = true},
        {name = "Reaper", pattern = "Reaper", enabled = true},
        {name = "Elite Deathaxe Skeleton", pattern = "EliteDeathaxeSkeleton", enabled = true},
        {name = "Elite Rogue Skeleton", pattern = "EliteRogueSkeleton", enabled = true},
        {name = "Deathaxe Skeleton", pattern = "DeathaxeSkeleton", enabled = true},
        {name = "Axe Skeleton", pattern = "AxeSkeleton", enabled = true},
        {name = "Skeleton Rogue", pattern = "SkeletonRogue", enabled = true},
        {name = "Bomber", pattern = "Bomber", enabled = true},
    }
}

local config = _G.MobFarmConfig

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- AUTO WORLD 2 TELEPORT SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function tweenToPosition(position)
    local character = LocalPlayer.Character
    if not character then return false end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end
    
    humanoidRootPart.CFrame = CFrame.new(position)
    return true
end

local function findPortalTool()
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    local character = LocalPlayer.Character
    
    if backpack then
        for _, tool in pairs(backpack:GetChildren()) do
            if tool:IsA("Tool") and string.find(tool.Name:lower(), "portal") then
                print("âœ… Found PortalTool in backpack:", tool.Name)
                return tool
            end
        end
    end
    
    if character then
        for _, tool in pairs(character:GetChildren()) do
            if tool:IsA("Tool") and string.find(tool.Name:lower(), "portal") then
                print("âœ… Found PortalTool in character:", tool.Name)
                return tool
            end
        end
    end
    
    warn("âŒ PortalTool not found")
    return nil
end

local function autoPlacePortal(position)
    print("ğŸ”§ Auto-placing portal at position:", position)
    
    local character = LocalPlayer.Character
    if not character then return nil end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid then return nil end
    
    local portalTool = findPortalTool()
    if not portalTool then
        warn("âŒ Please make sure you have a PortalTool in your inventory!")
        return nil
    end
    
    if portalTool.Parent ~= character then
        humanoid:EquipTool(portalTool)
        wait(0.5)
    end
    
    tweenToPosition(position)
    wait(0.5)
    
    portalTool:Activate()
    wait(0.3)
    
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
    wait(0.1)
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
    wait(1)
    
    local debris = workspace:FindFirstChild("Debris")
    if debris then
        for _, child in pairs(debris:GetChildren()) do
            if string.find(child.Name, "Portal") then
                print("âœ… Portal placed successfully:", child.Name)
                return child
            end
        end
    end
    
    return nil
end

local function findClosestPortal()
    local character = LocalPlayer.Character
    if not character then return nil end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return nil end
    
    local playerPos = humanoidRootPart.Position
    local closestPortal = nil
    local closestDistance = math.huge
    
    local debris = workspace:FindFirstChild("Debris")
    if debris then
        for _, child in pairs(debris:GetChildren()) do
            if string.find(child.Name, "Portal") then
                local portalPos = child:GetPivot().Position
                local distance = (playerPos - portalPos).Magnitude
                
                if distance < closestDistance then
                    closestDistance = distance
                    closestPortal = child
                end
            end
        end
    end
    
    return closestPortal
end

local function interactWithPortal(portal)
    if not portal then return false end
    
    local character = LocalPlayer.Character
    if not character then return false end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end
    
    local portalPosition = portal:GetPivot().Position
    tweenToPosition(portalPosition + Vector3.new(0, 0, 3))
    wait(0.5)
    
    for i = 1, 5 do
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
        wait(0.05)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
        wait(0.3)
        
        local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
        if playerGui then
            local mainGui = playerGui:FindFirstChild("Main")
            if mainGui then
                local screen = mainGui:FindFirstChild("Screen")
                if screen then
                    local teleportFrame = screen:FindFirstChild("Teleport")
                    if teleportFrame and teleportFrame.Visible then
                        print("âœ… Portal GUI opened")
                        wait(0.5)
                        return true
                    end
                end
            end
        end
    end
    
    return true
end

local function selectWorldInPortalGUI()
    print("ğŸ® Selecting Forgotten Kingdom...")
    
    local playerGui = LocalPlayer:WaitForChild("PlayerGui")
    wait(1)

    local mainGui = playerGui:WaitForChild("Main", 10)
    if not mainGui then return false end

    local screen = mainGui:WaitForChild("Screen", 10)
    if not screen then return false end

    local teleportGui = screen:WaitForChild("Teleport", 10)
    if not teleportGui then return false end

    local waitTime = 0
    while not teleportGui.Visible and waitTime < 5 do
        wait(0.1)
        waitTime = waitTime + 0.1
    end

    if not teleportGui.Visible then return false end

    local teleportList = teleportGui:WaitForChild("List", 5)
    local infoFrame = teleportGui:WaitForChild("InfoFrame", 5)

    if not teleportList then return false end

    local forgottenKingdomEntry = teleportList:FindFirstChild("Forgotten Kingdom")
    local teleportButton = infoFrame:FindFirstChild("Teleport")

    if not forgottenKingdomEntry or not teleportButton then return false end

    GuiService.SelectedObject = forgottenKingdomEntry
    wait(0.1)

    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
    wait(0.02)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
    wait(0.1)

    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Right, false, game)
    wait(0.02)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Right, false, game)
    wait(0.05)
    
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Down, false, game)
    wait(0.02)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Down, false, game)
    wait(0.05)

    if GuiService.SelectedObject ~= teleportButton then
        GuiService.SelectedObject = teleportButton
        wait(0.2)
    end

    for i = 1, 5 do
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
        wait(0.05)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
        wait(0.2)
        
        if not teleportGui.Parent or not teleportGui.Visible then
            print("âœ¨ Teleport successful!")
            return true
        end
    end

    return false
end

local function executeAutoTeleport()
    print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
    print("ğŸ”„ Starting Auto-Teleport to World 2...")
    print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")

    wait(2)

    local portal = autoPlacePortal(PORTAL_PLACEMENT_POSITION)
    
    if not portal then
        portal = findClosestPortal()
    end
    
    if not portal then
        warn("âŒ Failed to place or find portal")
        return
    end

    if not interactWithPortal(portal) then
        warn("âŒ Failed to interact with portal")
        return
    end

    if not selectWorldInPortalGUI() then
        warn("âŒ Failed to select world")
        return
    end

    print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
    print("âœ… Auto-Teleport completed!")
    print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NOCLIP SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function startNoclip()
    if config.noclipLoop then return end
    
    config.noclipLoop = RunService.Stepped:Connect(function()
        if not config.enabled then return end
        
        local character = LocalPlayer.Character
        if not character then return end
        
        for _, part in pairs(character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end)
    
    print("âœ… Noclip enabled")
end

local function stopNoclip()
    if config.noclipLoop then
        config.noclipLoop:Disconnect()
        config.noclipLoop = nil
        
        local character = LocalPlayer.Character
        if character then
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = true
                end
            end
        end
        
        print("ğŸ”’ Noclip disabled")
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- UTILITY FUNCTIONS (UPDATED)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function setupPhysicsMovement()
    local character = LocalPlayer.Character
    if not character then return false end
    
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return false end
    
    -- Clean up old instances
    if config.bodyVelocity and config.bodyVelocity.Parent then
        config.bodyVelocity:Destroy()
    end
    if config.bodyGyro and config.bodyGyro.Parent then
        config.bodyGyro:Destroy()
    end
    
    -- Wait a frame to ensure cleanup
    task.wait()
    
    local bv = Instance.new("BodyVelocity")
    bv.Name = "FarmVelocity"
    bv.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    bv.Velocity = Vector3.new(0, 0, 0)
    bv.P = 1250
    bv.Parent = rootPart
    config.bodyVelocity = bv
    
    local bg = Instance.new("BodyGyro")
    bg.Name = "FarmGyro"
    bg.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    bg.P = 10000
    bg.D = 500
    bg.Parent = rootPart
    config.bodyGyro = bg
    
    rootPart.Anchored = false
    
    print("âœ… Physics movement setup")
    return true
end

local function hoverToPosition(targetPos, mob)
    local character = LocalPlayer.Character
    if not character then return end
    
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    local mobRoot = mob:FindFirstChild("HumanoidRootPart")
    
    if not rootPart or not mobRoot then return end
    
    -- CRITICAL FIX: Check if physics objects still exist and recreate if needed
    if not config.bodyVelocity or not config.bodyVelocity.Parent then
        setupPhysicsMovement()
        return
    end
    if not config.bodyGyro or not config.bodyGyro.Parent then
        setupPhysicsMovement()
        return
    end
    
    local currentPos = rootPart.Position
    local direction = (targetPos - currentPos)
    local distance = direction.Magnitude
    
    local bobbing = math.sin(tick() * 2) * 0.3
    local bobbedTarget = targetPos + Vector3.new(0, bobbing, 0)
    direction = (bobbedTarget - currentPos)
    
    local speedMultiplier = math.min(distance / 10, 1)
    local targetSpeed = config.hoverSpeed * speedMultiplier
    
    local desiredVelocity
    if direction.Magnitude > 0 then
        desiredVelocity = direction.Unit * math.min(distance * config.acceleration, targetSpeed)
    else
        desiredVelocity = Vector3.new(0, 0, 0)
    end
    
    local currentVelocity = config.bodyVelocity.Velocity
    local newVelocity = currentVelocity:Lerp(desiredVelocity, 0.5)
    
    config.bodyVelocity.Velocity = newVelocity
    
    local lookAtPos = mobRoot.Position
    local lookCFrame = CFrame.new(currentPos, lookAtPos)
    config.bodyGyro.CFrame = lookCFrame
    
    if config.lockPosition == "Above" or config.lockPosition == "Below" then
        local currentTime = tick()
        
        if currentTime - config.lastUnlockTime >= config.unlockInterval then
            local oldForce = config.bodyVelocity.MaxForce
            config.bodyVelocity.MaxForce = Vector3.new(0, 0, 0)
            task.wait(0.05)
            if config.bodyVelocity and config.bodyVelocity.Parent then
                config.bodyVelocity.MaxForce = oldForce
            end
            config.lastUnlockTime = currentTime
        end
    end
end

local function cleanupPhysicsMovement()
    if config.bodyVelocity then
        config.bodyVelocity:Destroy()
        config.bodyVelocity = nil
    end
    if config.bodyGyro then
        config.bodyGyro:Destroy()
        config.bodyGyro = nil
    end
    
    local character = LocalPlayer.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            rootPart.Anchored = false
            rootPart.Velocity = Vector3.new(0, 0, 0)
        end
    end
    
    print("ğŸ§¹ Physics cleaned up")
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- AUTO-CLICKER & WEAPON
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local clickerLoop = nil

local function autoEquipWeapon()
    local character = LocalPlayer.Character
    if not character then return false end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return false end
    
    local weaponInChar = character:FindFirstChild("Weapon")
    if weaponInChar and weaponInChar:IsA("Tool") then
        if not humanoid:FindFirstChild("Weapon") then
            humanoid:EquipTool(weaponInChar)
            print("âš”ï¸ Equipped Weapon")
        end
        return true
    end
    
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    if backpack then
        local weapon = backpack:FindFirstChild("Weapon")
        if weapon and weapon:IsA("Tool") then
            humanoid:EquipTool(weapon)
            print("âš”ï¸ Auto-equipped Weapon")
            return true
        end
    end
    
    return false
end

local function startAutoClicker()
    if clickerLoop then return end
    
    task.spawn(function()
        task.wait(0.5)
        autoEquipWeapon()
    end)
    
    clickerLoop = RunService.Heartbeat:Connect(function()
        if not config.enabled then return end
        
        pcall(function()
            mouse1click()
        end)
        
        task.wait(0.1)
    end)
    
    print("ğŸ–±ï¸ Auto-clicker started")
end

local function stopAutoClicker()
    if clickerLoop then
        clickerLoop:Disconnect()
        clickerLoop = nil
        print("ğŸ–±ï¸ Auto-clicker stopped")
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- GUI
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Mob Farm v4.3 - Fast + Noclip + Auto World 2",
    LoadingTitle = "Loading Mob Farm",
    LoadingSubtitle = "Fast Hover + Noclip + Auto World 2!",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MobFarmV43",
        FileName = "Config"
    },
    Discord = {Enabled = false},
    KeySystem = false
})

local MainTab = Window:CreateTab("Main", 4483362458)
local World2Tab = Window:CreateTab("World 2", 4483362458)

local farmLoop = nil
local keybindConnection = nil
local characterConnection = nil

local EnableToggle = MainTab:CreateToggle({
    Name = "ğŸ¤– Enable Farm (F1)",
    CurrentValue = false,
    Flag = "EnableToggle",
    Callback = function(Value)
        config.enabled = Value
        
        if Value then
            setupPhysicsMovement()
            startNoclip()
            startAutoClicker()
            print("âœ… Farm ENABLED")
        else
            stopAutoClicker()
            stopNoclip()
            cleanupPhysicsMovement()
            config.currentMob = nil
            print("âŒ Farm DISABLED")
        end
    end,
})

local MobDropdown = MainTab:CreateDropdown({
    Name = "Select Mobs to Farm",
    Options = {},
    CurrentOption = {},
    MultipleOptions = true,
    Flag = "MobDropdown",
    Callback = function(Options)
        for _, mobData in ipairs(config.mobTypes) do
            mobData.enabled = false
        end
        
        for _, selectedName in pairs(Options) do
            for _, mobData in ipairs(config.mobTypes) do
                if mobData.name == selectedName then
                    mobData.enabled = true
                    break
                end
            end
        end
    end,
})

local mobNames = {}
for _, mobData in ipairs(config.mobTypes) do
    table.insert(mobNames, mobData.name)
end
MobDropdown:Refresh(mobNames, mobNames)

MainTab:CreateSlider({
    Name = "Lock Distance",
    Range = {8, 20},
    Increment = 1,
    CurrentValue = 12,
    Flag = "LockDistance",
    Callback = function(Value) 
        config.behindDistance = Value 
    end,
})

MainTab:CreateSlider({
    Name = "Vertical Distance (Above/Below)",
    Range = {8, 30},
    Increment = 1,
    CurrentValue = 15,
    Flag = "VerticalDistance",
    Callback = function(Value) 
        config.verticalDistance = Value 
    end,
})

MainTab:CreateDropdown({
    Name = "Lock Position",
    Options = {"Back", "Front", "Above", "Below"},
    CurrentOption = "Back",
    Flag = "LockPosition",
    Callback = function(Option)
        if type(Option) == "table" then
            config.lockPosition = Option[1] or "Back"
        else
            config.lockPosition = Option
        end
        print("ğŸ¯ Lock position:", config.lockPosition)
    end,
})

MainTab:CreateSlider({
    Name = "Hover Speed",
    Range = {20, 150},
    Increment = 10,
    CurrentValue = 80,
    Flag = "HoverSpeed",
    Callback = function(Value) 
        config.hoverSpeed = Value 
    end,
})

MainTab:CreateSlider({
    Name = "Acceleration",
    Range = {10, 80},
    Increment = 5,
    CurrentValue = 40,
    Flag = "Acceleration",
    Callback = function(Value) 
        config.acceleration = Value 
    end,
})

MainTab:CreateSlider({
    Name = "Max Farm Distance",
    Range = {100, 1000},
    Increment = 50,
    CurrentValue = 500,
    Flag = "FarmDistance",
    Callback = function(Value) 
        config.farmDistance = Value 
    end,
})

-- World 2 Tab
if currentWorld == 1 then
    World2Tab:CreateParagraph({
        Title = "ğŸŒ World 1 Detected",
        Content = "You are currently in World 1. The script will automatically teleport you to World 2 (Forgotten Kingdom) in a few seconds!\n\nâœ… Make sure you have a PortalTool in your inventory!"
    })
    
    World2Tab:CreateButton({
        Name = "ğŸš€ Teleport to World 2 Now",
        Callback = function()
            print("ğŸš€ Manual teleport triggered")
            task.spawn(executeAutoTeleport)
        end,
    })
else
    World2Tab:CreateParagraph({
        Title = "âœ… World 2 (Forgotten Kingdom)",
        Content = "You are already in World 2! Start farming by toggling the farm in the Main tab."
    })
end

MainTab:CreateButton({
    Name = "ğŸ—‘ï¸ Destroy GUI",
    Callback = function()
        print("ğŸ—‘ï¸ DESTROYING MOB FARM...")
        
        config.enabled = false
        stopAutoClicker()
        stopNoclip()
        cleanupPhysicsMovement()
        
        if farmLoop then
            farmLoop:Disconnect()
            farmLoop = nil
        end
        
        if keybindConnection then
            keybindConnection:Disconnect()
            keybindConnection = nil
        end
        
        if characterConnection then
            characterConnection:Disconnect()
            characterConnection = nil
        end
        
        _G.MobFarmConfig = nil
        Rayfield:Destroy()
        
        print("âœ… GUI Destroyed!")
    end,
})

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- MAIN FARM LOOP (FIXED)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

farmLoop = RunService.Heartbeat:Connect(function()
    if not config.enabled then return end
    
    -- Verify physics setup every frame
    local character = LocalPlayer.Character
    if not character then return end
    
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return end
    
    -- CRITICAL FIX: Recreate physics if missing
    if not config.bodyVelocity or not config.bodyVelocity.Parent or 
       not config.bodyGyro or not config.bodyGyro.Parent then
        setupPhysicsMovement()
        return
    end
    
    local needNewMob = false
    
    if not config.currentMob or not config.currentMob.Parent then
        needNewMob = true
    else
        local humanoid = config.currentMob:FindFirstChild("Humanoid")
        if not humanoid or humanoid.Health <= 0 then
            needNewMob = true
        end
    end
    
    if needNewMob then
        local newMob = getClosestMob()
        
        if newMob then
            print("ğŸ¯ New target:", newMob.Name)
            config.currentMob = newMob
            config.lastUnlockTime = tick()
        else
            config.currentMob = nil
        end
        
        return
    end
    
    if config.currentMob then
        local lockPos = getLockPosition(config.currentMob)
        if lockPos then
            hoverToPosition(lockPos, config.currentMob)
        end
    end
end)

-- F1 Keybind
keybindConnection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.F1 then
        config.enabled = not config.enabled
        EnableToggle:Set(config.enabled)
    end
end)

-- Cleanup on character respawn
characterConnection = LocalPlayer.CharacterAdded:Connect(function()
    config.currentMob = nil
    cleanupPhysicsMovement()
    stopNoclip()
    
    if config.enabled then
        task.wait(2)
        setupPhysicsMovement()
        startNoclip()
        autoEquipWeapon()
        print("âš”ï¸ Re-equipped after respawn + Noclip restored")
    end
end)

print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("MOB FARM v4.2 - FAST HOVER + NOCLIP LOADED!")
print("âœ… 3x faster hovering (80 studs/sec)")
print("âœ… Noclip enabled - pass through walls!")
print("âœ… Increased acceleration & force")
print("âœ… Still anti-cheat safe!")
print("â€¢ Press F1 to start!")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- STARTUP
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("MOB FARM v4.7d LOADED! (HOVER + RAYFIELD + SAFE CLICKER + WORLD 2 AUTO-JOIN + MULTI-MOB PRIORITY)")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("F1 = Toggle farm")
print("F2 = Change position")
print("F3 = Speed +10")
print("F4 = Speed -10")
print("DELETE = Change mob target (single-target focus)")
print("F5 = Vertical Distance +1")
print("F6 = Vertical Distance -1")
print("F8 = DESTROY SCRIPT")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("Default Targets: Reaper (use DELETE for single-target, or UI dropdown for multi-target with priority).")
print("Click interval: 0.20 seconds via ToolActivated remote")
print("Use 'World 2' tab in Rayfield to view Auto-Join settings (always on in World 1).")
print("Press F1 or toggle in Rayfield to start farming!")
print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- AUTO RE-EXECUTE ON SERVER HOP / TELEPORT
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local ScriptURL = "https://raw.githubusercontent.com/HellishHumanoid/TF/refs/heads/main/theforge"  -- <-- REPLACE THIS

local function queueScript()
    local code = 'loadstring(game:HttpGet("' .. ScriptURL .. '"))()'

    if queue_on_teleport then
        queue_on_teleport(code)
    elseif syn and syn.queue_on_teleport then
        syn.queue_on_teleport(code)
    elseif fluxus and fluxus.queue_on_teleport then
        fluxus.queue_on_teleport(code)
    elseif KRNL_LOADED and queue_on_teleport then
        queue_on_teleport(code)
    elseif getgenv().queue_on_teleport then
        getgenv().queue_on_teleport(code)
    else
        warn("[MobFarm] queue_on_teleport is not supported in this executor!")
    end
end

-- Run as soon as script loads
queueScript()

-- Handle teleport events
local TeleportService = game:GetService("TeleportService")

TeleportService.LocalPlayerArriving:Connect(function()
    queueScript()
end)

TeleportService.PlayerTeleporting:Connect(function()
    queueScript()
end)

-- âœ… ONE CLEAN COMBINED SCRIPT: ANTI-AFK + YOUR AUTO-REJOIN

local Players = game:GetService("Players")
local GuiService = game:GetService("GuiService")
local TeleportService = game:GetService("TeleportService")
local VirtualUser = game:GetService("VirtualUser")

local player = Players.LocalPlayer

------------------------------------------------------
-- 1) ANTI-AFK (does NOT touch your rejoin logic)
------------------------------------------------------
player.Idled:Connect(function()
    print("[Anti-AFK] Preventing idle kick...")

    -- pcall so Anti-AFK can NEVER break the rest
    pcall(function()
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new(), workspace.CurrentCamera and workspace.CurrentCamera.CFrame or CFrame.new())
    end)
end)

------------------------------------------------------
-- 2) YOUR ORIGINAL AUTO-REJOIN (UNCHANGED IN LOGIC)
------------------------------------------------------
local function onErrorMessageChanged(errorMessage)
    if errorMessage and errorMessage ~= "" then
        print("Error detected: " .. errorMessage)

        if player then
            wait()
            TeleportService:Teleport(game.PlaceId, player)
        end
    end
end

GuiService.ErrorMessageChanged:Connect(onErrorMessageChanged)

print("[Anti-AFK + Auto-Rejoin] Loaded")
