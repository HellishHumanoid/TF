-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- THE FORGE - WORLD DETECTION + AUTO-REJOIN + ANTI-AFK + RE-EXECUTE SYSTEM
-- Automatically detects which world you're in and loads the correct script
-- Re-executes on respawn/rejoin/server hop like Infinite Yield
-- Created by Rafso [literalh]
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local Players = game:GetService("Players")
local GuiService = game:GetService("GuiService")
local TeleportService = game:GetService("TeleportService")
local VirtualUser = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- RE-EXECUTE SYSTEM (Like Infinite Yield)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local SCRIPT_URL = "https://raw.githubusercontent.com/HellishHumanoid/TF/refs/heads/main/theforgemain"

local function saveReExecute()
	if not isfolder("TheForge") then
		makefolder("TheForge")
	end
	writefile("TheForge/re-execute.txt", SCRIPT_URL)
	print("âœ… Re-Execute: Script URL saved for next rejoin")
end

local function setupReExecute()
	-- Save the script for re-execution
	pcall(saveReExecute)
	
	-- âœ… CRITICAL: Re-execute on character respawn (death)
	LocalPlayer.CharacterAdded:Connect(function(character)
		-- Wait for character to spawn
		character:WaitForChild("HumanoidRootPart", 10)
		task.wait(3)
		
		print("ğŸ”„ Re-Execute: Character respawned, reloading script...")
		
		pcall(function()
			loadstring(game:HttpGet(SCRIPT_URL))()
		end)
	end)
	
	print("âœ… Re-Execute: System enabled (will run on respawn & server hop)")
end

-- âœ… CRITICAL: Check if this is a re-execution and run immediately
local isReExecution = false
if isfolder("TheForge") and isfile("TheForge/re-execute.txt") then
	isReExecution = true
	print("ğŸ”„ Re-Execute: Detected previous session - This is a re-execution!")
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- NOTIFICATION SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function sendNotification(title, text, duration)
	pcall(function()
		game:GetService("StarterGui"):SetCore("SendNotification", {
			Title = title;
			Text = text;
			Duration = duration or 5;
		})
	end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ENHANCED AUTO-REJOIN SYSTEM (Handles kicks AND server hops)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function setupAutoRejoin()
	sendNotification("Auto-Rejoin", "Auto-Rejoin & Server Hop detection enabled!", 3)
	
	-- âœ… Handle error messages (kicks, disconnects)
	GuiService.ErrorMessageChanged:Connect(function(errorMessage)
		if errorMessage and errorMessage ~= "" then
			print("âŒ Error detected: " .. errorMessage)
			sendNotification("Auto-Rejoin", "Kicked! Rejoining in 2s...", 3)
			
			-- Save re-execute file
			pcall(saveReExecute)
			
			task.wait(2)
			
			pcall(function()
				TeleportService:Teleport(game.PlaceId, LocalPlayer)
			end)
		end
	end)
	
	-- âœ… CRITICAL: Detect server hop and queue re-execute
	LocalPlayer.OnTeleport:Connect(function(state)
		if state == Enum.TeleportState.Started then
			print("ğŸŒ Server Hop Detected! Queueing re-execute...")
			sendNotification("Server Hop", "Script will re-execute on new server!", 3)
			
			-- Save re-execute file
			pcall(saveReExecute)
			
			-- âœ… Queue script to run after teleport
			local queueSuccess = pcall(function()
				queue_on_teleport([[
					task.wait(5)
					print("ğŸ”„ Re-Execute: Loading script on new server...")
					pcall(function()
						loadstring(game:HttpGet("]] .. SCRIPT_URL .. [["))()
					end)
				]])
			end)
			
			if queueSuccess then
				print("âœ… Script queued for new server!")
			else
				warn("âš ï¸ Failed to queue script (executor might not support queue_on_teleport)")
			end
		end
	end)
	
	-- âœ… Detect teleport failures and retry
	TeleportService.TeleportInitFailed:Connect(function(player, result, errorMessage)
		print("âŒ Teleport failed: " .. tostring(result))
		
		task.wait(2)
		pcall(function()
			TeleportService:Teleport(game.PlaceId, LocalPlayer)
		end)
	end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ANTI-AFK SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function setupAntiAFK()
	sendNotification("Anti-AFK", "Anti-AFK system enabled!", 3)
	
	-- Connection to prevent AFK kick
	LocalPlayer.Idled:Connect(function()
		VirtualUser:CaptureController()
		VirtualUser:ClickButton2(Vector2.new())
		print("âš¡ Anti-AFK: Prevented idle kick")
	end)
	
	-- Additional anti-AFK measures
	task.spawn(function()
		while true do
			task.wait(300) -- Every 5 minutes
			
			pcall(function()
				VirtualUser:CaptureController()
				VirtualUser:ClickButton2(Vector2.new())
			end)
			
			print("âš¡ Anti-AFK: Activity simulated")
		end
	end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- WORLD DETECTION LOGIC
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function detectWorld()
	sendNotification("The Forge", "Detecting world...", 3)
	
	-- Wait for workspace to load
	local workspace = game:GetService("Workspace")
	local proximity = workspace:WaitForChild("Proximity", 10)
	
	if not proximity then
		sendNotification("Detection Failed", "Could not find Proximity folder!", 5)
		return nil
	end
	
	-- Check for World 1: Stonewake's Cross (Arcane Pickaxe)
	local arcanePickaxe = proximity:FindFirstChild("Arcane Pickaxe")
	if arcanePickaxe then
		sendNotification("World Detected", "Stonewake's Cross (World 1)", 4)
		return "World1"
	end
	
	-- Check for World 2: Forgotten Kingdom (Demonic Pickaxe)
	local demonicPickaxe = proximity:FindFirstChild("Demonic Pickaxe")
	if demonicPickaxe then
		sendNotification("World Detected", "Forgotten Kingdom (World 2)", 4)
		return "World2"
	end
	
	-- Unknown world
	sendNotification("Detection Failed", "Unknown world or pickaxes not found!", 5)
	return nil
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SCRIPT LOADER WITH ENHANCED ERROR HANDLING
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function loadWorldScript(world)
	if world == "World1" then
		sendNotification("Loading Script", "Stonewake's Cross loading...", 3)
		
		-- Wait a bit for world to fully load
		task.wait(2)
		
		local success, result = pcall(function()
			local scriptContent = game:HttpGet('https://raw.githubusercontent.com/HellishHumanoid/TF/refs/heads/main/theforgestonewakescross')
			
			if scriptContent and scriptContent ~= "" then
				local loadFunc, loadErr = loadstring(scriptContent)
				
				if loadFunc then
					loadFunc()
					return true
				else
					error("Failed to compile script: " .. tostring(loadErr))
				end
			else
				error("Failed to retrieve script from GitHub")
			end
		end)
		
		if success then
			sendNotification("Success!", "Stonewake's Cross loaded!", 4)
		else
			sendNotification("Load Failed", "Please check console for details", 5)
			warn("Stonewake's Cross Load Error: " .. tostring(result))
			
			-- Retry after 5 seconds
			task.wait(5)
			sendNotification("Retry", "Attempting to reload script...", 3)
			
			pcall(function()
				loadstring(game:HttpGet('https://raw.githubusercontent.com/HellishHumanoid/TF/refs/heads/main/theforgestonewakescross'))()
			end)
		end
		
	elseif world == "World2" then
		sendNotification("Loading Script", "Forgotten Kingdom loading...", 3)
		
		-- Wait a bit for world to fully load
		task.wait(2)
		
		local success, result = pcall(function()
			local scriptContent = game:HttpGet('https://raw.githubusercontent.com/HellishHumanoid/TF/refs/heads/main/theforgeforgottenkingdom')
			
			if scriptContent and scriptContent ~= "" then
				local loadFunc, loadErr = loadstring(scriptContent)
				
				if loadFunc then
					loadFunc()
					return true
				else
					error("Failed to compile script: " .. tostring(loadErr))
				end
			else
				error("Failed to retrieve script from GitHub")
			end
		end)
		
		if success then
			sendNotification("Success!", "Forgotten Kingdom loaded!", 4)
		else
			sendNotification("Load Failed", "Please check console for details", 5)
			warn("Forgotten Kingdom Load Error: " .. tostring(result))
			
			-- Retry after 5 seconds
			task.wait(5)
			sendNotification("Retry", "Attempting to reload script...", 3)
			
			pcall(function()
				loadstring(game:HttpGet('https://raw.githubusercontent.com/HellishHumanoid/TF/refs/heads/main/theforgeforgottenkingdom'))()
			end)
		end
		
	else
		sendNotification("Error", "Invalid world detected!", 5)
	end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- MAIN EXECUTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if isReExecution then
	sendNotification("The Forge", "ğŸ”„ Re-Executing by Rafso...", 3)
	print("ğŸ”„ This is a RE-EXECUTION!")
else
	sendNotification("The Forge", "âš¡ Initializing by Rafso...", 3)
	print("âš¡ First-time execution!")
end

-- âœ… Setup Re-Execute System (ALWAYS runs - saves for next time)
task.spawn(function()
	pcall(setupReExecute)
	sendNotification("Re-Execute", "System enabled! Will run on respawn & server hop", 3)
end)

-- Setup Auto-Rejoin System (handles kicks AND server hops)
task.spawn(function()
	task.wait(0.5)
	pcall(setupAutoRejoin)
end)

-- Setup Anti-AFK System
task.spawn(function()
	task.wait(1)
	pcall(setupAntiAFK)
end)

-- Wait for character to load
if not LocalPlayer.Character then
	LocalPlayer.CharacterAdded:Wait()
end

-- Small delay to ensure everything is loaded
task.wait(3)

-- Detect world and load appropriate script
local detectedWorld = detectWorld()

if detectedWorld then
	task.wait(1)
	loadWorldScript(detectedWorld)
else
	sendNotification("Manual Selection", "Retrying detection...", 5)
	
	-- Fallback: Try to detect again after 5 seconds
	task.wait(5)
	local retryWorld = detectWorld()
	if retryWorld then
		task.wait(1)
		loadWorldScript(retryWorld)
	else
		sendNotification("Failed", "Could not detect world!", 5)
	end
end

print("âœ… Hub script fully loaded! Re-execute system active.")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- END OF WORLD DETECTION + AUTO-REJOIN + ANTI-AFK + RE-EXECUTE SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
